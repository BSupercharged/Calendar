<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 Calendar - Charge Europe</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            padding: 20px;
        }

        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
            border: 3px solid #a4d233;
        }

        .header {
            background: white;
            color: #2c3e50;
            padding: 30px;
            text-align: center;
            position: relative;
            border-bottom: 3px solid #a4d233;
        }

        .header-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 10px;
        }

        .logo-icon {
            width: 80px;
            height: 80px;
        }

        .logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .header h1 {
            font-size: 2.5em;
            margin: 0;
            color: #2c3e50;
            font-weight: 700;
        }

        .header p {
            margin: 5px 0 0 0;
            color: #6c757d;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            border-left: 4px solid #a4d233;
            flex-wrap: wrap;
            gap: 15px;
        }

        .view-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: #a4d233;
            color: #2c3e50;
            font-weight: 600;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(164, 210, 51, 0.4);
            background: #92bd2a;
        }

        .btn-secondary {
            background: white;
            color: #a4d233;
            border: 2px solid #a4d233;
        }

        .btn-secondary:hover {
            background: #a4d233;
            color: #2c3e50;
        }

        .btn-secondary.active {
            background: #a4d233;
            color: #2c3e50;
        }

        .navigation {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-btn {
            background: #a4d233;
            color: #2c3e50;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
            font-weight: bold;
        }

        .nav-btn:hover {
            background: #92bd2a;
            transform: scale(1.1);
        }

        .current-period {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
            min-width: 200px;
            text-align: center;
        }

        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            padding: 15px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            border-left: 4px solid #a4d233;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .calendar-content {
            padding: 30px;
            min-height: 600px;
        }

        /* Year View */
        .year-view {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }

        .month-mini {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .month-mini:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #a4d233;
        }

        .month-mini h3 {
            text-align: center;
            margin-bottom: 12px;
            color: #a4d233;
            font-size: 1.1em;
        }

        .mini-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .mini-day-header {
            text-align: center;
            font-size: 11px;
            font-weight: 600;
            color: #666;
            padding: 4px;
        }

        .mini-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            border-radius: 4px;
            position: relative;
            flex-direction: column;
            gap: 1px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .mini-day:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        .mini-day.has-event {
            color: white;
            font-weight: 600;
        }

        .mini-day.has-event.event {
            background: #667eea;
        }

        .mini-day.has-event.holiday {
            background: #e74c3c;
        }

        .mini-day.has-event.birthday {
            background: #f39c12;
        }

        .mini-day.has-event.office {
            background: #27ae60;
        }

        .mini-day.has-event.employee-holiday {
            background: #9b59b6;
        }

        .mini-day.has-event.other {
            background: #34495e;
        }

        .mini-day.has-event.multiple {
            background: linear-gradient(135deg, #667eea 0%, #e74c3c 50%, #f39c12 100%);
        }

        .mini-day-number {
            font-size: 12px;
        }

        .mini-day-events {
            display: none;
        }

        .mini-day-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            white-space: nowrap;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            margin-bottom: 5px;
        }

        .mini-day:hover .mini-day-tooltip {
            opacity: 1;
        }

        .mini-day-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
        }

        .mini-day.other-month {
            color: #ccc;
        }

        .mini-day.today {
            background: #ffd700;
            font-weight: bold;
        }

        /* Month View */
        .month-view {
            background: white;
        }

        .month-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e9ecef;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
        }

        .day-header {
            background: #f8f9fa;
            color: #2c3e50;
            text-align: center;
            padding: 15px;
            font-weight: 600;
            font-size: 14px;
            border-bottom: 2px solid #a4d233;
        }

        .day-cell {
            background: white;
            min-height: 120px;
            padding: 8px;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }

        .day-cell:hover {
            background: #f8f9fa;
        }

        .day-cell.other-month {
            background: #f8f9fa;
            color: #adb5bd;
        }

        .day-cell.today {
            background: #fff9e6;
            border: 2px solid #ffd700;
        }

        .day-number {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .day-events {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .event-badge {
            font-size: 11px;
            padding: 3px 6px;
            border-radius: 4px;
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
            transition: all 0.2s;
        }

        .event-badge:hover {
            transform: scale(1.05);
            z-index: 10;
        }

        .event-badge.event {
            background: #667eea;
        }

        .event-badge.holiday {
            background: #e74c3c;
        }

        .event-badge.birthday {
            background: #f39c12;
        }

        .event-badge.office {
            background: #27ae60;
        }

        .event-badge.employee-holiday {
            background: #9b59b6;
        }

        .event-badge.other {
            background: #34495e;
        }

        /* Week View */
        .week-view {
            background: white;
        }

        .week-grid {
            display: grid;
            grid-template-columns: 60px repeat(7, 1fr);
            gap: 1px;
            background: #e9ecef;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
        }

        .time-slot {
            background: white;
            padding: 10px;
            text-align: center;
            font-size: 12px;
            color: #666;
            border-right: 1px solid #e9ecef;
        }

        .week-day-header {
            background: #f8f9fa;
            color: #2c3e50;
            text-align: center;
            padding: 15px 10px;
            font-weight: 600;
            border-bottom: 2px solid #a4d233;
        }

        .week-day-cell {
            background: white;
            padding: 10px;
            min-height: 100px;
            position: relative;
        }

        .week-day-cell.today {
            background: #fff9e6;
        }

        .week-event {
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 6px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .week-event:hover {
            transform: translateX(5px);
        }

        .week-event.event {
            background: #667eea;
        }

        .week-event.holiday {
            background: #e74c3c;
        }

        .week-event.birthday {
            background: #f39c12;
        }

        .week-event.office {
            background: #27ae60;
        }

        .week-event.employee-holiday {
            background: #9b59b6;
        }

        .week-event.other {
            background: #34495e;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .modal-header h2 {
            color: #a4d233;
            font-size: 1.5em;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #adb5bd;
            transition: all 0.3s;
        }

        .close-btn:hover {
            color: #e74c3c;
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #a4d233;
            box-shadow: 0 0 0 3px rgba(164, 210, 51, 0.1);
        }

        .event-details {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .event-details p {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .event-details strong {
            color: #a4d233;
        }

        .event-details a {
            color: #a4d233;
            text-decoration: none;
            word-break: break-all;
        }

        .event-details a:hover {
            text-decoration: underline;
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
            margin-top: 10px;
        }

        .btn-delete:hover {
            background: #c0392b;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }

            .year-view {
                grid-template-columns: 1fr;
            }

            .month-grid,
            .week-grid {
                font-size: 12px;
            }

            .day-cell {
                min-height: 80px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-logo">
                <div class="logo-icon">
                    <img src="data:image/jpeg;base64,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" alt="Chargedot Logo">
                </div>
                <div>
                    <h1>Chargedot Europe 2026 Calendar</h1>
                    <p>EV Charging Events, Dutch Holidays & Team Birthdays</p>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="view-buttons">
                <button class="btn btn-secondary active" onclick="changeView('year')">Year</button>
                <button class="btn btn-secondary" onclick="changeView('month')">Month</button>
                <button class="btn btn-secondary" onclick="changeView('week')">Week</button>
            </div>
            
            <div class="navigation">
                <button class="nav-btn" onclick="navigate(-1)">←</button>
                <div class="current-period" id="currentPeriod">2026</div>
                <button class="nav-btn" onclick="navigate(1)">→</button>
            </div>

            <button class="btn btn-primary" onclick="openAddModal()">+ Add Event</button>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #667eea;"></div>
                <span>EV Events</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #e74c3c;"></div>
                <span>Dutch Holidays</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f39c12;"></div>
                <span>Birthdays</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #27ae60;"></div>
                <span>Office Days</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #9b59b6;"></div>
                <span>Employee Holidays</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #34495e;"></div>
                <span>Other</span>
            </div>
        </div>

        <div class="calendar-content" id="calendarContent">
            <div style="padding: 50px; text-align: center; color: #6c757d;">
                <h2>Loading calendar...</h2>
                <p>If this message persists, please refresh the page.</p>
            </div>
        </div>
    </div>

    <!-- Add Event Modal -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Event</h2>
                <button class="close-btn" onclick="closeModal('addModal')">&times;</button>
            </div>
            <form onsubmit="addEvent(event)">
                <div class="form-group">
                    <label>Event Type</label>
                    <select id="eventType" required onchange="updateFormForType()">
                        <option value="birthday">Birthday</option>
                        <option value="employee-holiday">Employee Holiday</option>
                        <option value="event">EV Event</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label id="nameLabel">Name</label>
                    <input type="text" id="eventName" required placeholder="Team member name">
                </div>
                <div class="form-group">
                    <label>Start Date</label>
                    <input type="date" id="eventDate" required>
                </div>
                <div class="form-group">
                    <label>End Date (optional)</label>
                    <input type="date" id="eventEndDate">
                </div>
                <div class="form-group">
                    <label>Notes (optional)</label>
                    <textarea id="eventNotes" rows="3" placeholder="Any special notes..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Add Event</button>
            </form>
        </div>
    </div>

    <!-- View Event Modal -->
    <div class="modal" id="viewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="viewEventTitle"></h2>
                <button class="close-btn" onclick="closeModal('viewModal')">&times;</button>
            </div>
            <div id="viewEventContent"></div>
        </div>
    </div>

    <script>
        // Password protection
        (function() {
            const correctPassword = 'NLCAM';
            const sessionKey = 'calendarAuthenticated';
            
            // Check if already authenticated
            if (localStorage.getItem(sessionKey) === 'true') {
                return; // Already authenticated, continue loading
            }
            
            // Prompt for password
            const enteredPassword = prompt('Please enter the password to access the calendar:');
            
            if (enteredPassword === correctPassword) {
                localStorage.setItem(sessionKey, 'true');
                // Continue loading calendar
            } else {
                document.body.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100vh; font-family: Arial; background: #f8f9fa;"><div style="text-align: center; padding: 40px; background: white; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1);"><h1 style="color: #e74c3c; margin-bottom: 20px;">Access Denied</h1><p style="color: #6c757d;">Invalid password. Please refresh the page to try again.</p></div></div>';
                throw new Error('Authentication failed');
            }
        })();

        const CALENDAR_EVENTS = [
  {
    "id": "event_0",
    "title": "European EV Charging Infrastructure",
    "start": "2026-01-29",
    "end": "2026-01-30",
    "type": "event",
    "location": "Amsterdam, NL",
    "priority": "High",
    "website": "https://annual-ev-charging-infrastructure.com/"
  },
  {
    "id": "event_1",
    "title": "Charging Infrastructure Congress",
    "start": "2026-02-10",
    "end": "2026-02-10",
    "type": "event",
    "location": "Brussels, BE",
    "priority": "High",
    "website": "https://www.charginginfrastructure.eu/"
  },
  {
    "id": "event_2",
    "title": "EV Charging UK",
    "start": "2026-02-11",
    "end": "2026-02-12",
    "type": "event",
    "location": "London, UK",
    "priority": "High",
    "website": "https://www.uk.evcharging-infrastructure.com/"
  },
  {
    "id": "event_3",
    "title": "EVolution Europe: The Electric Vehicle Conference (EV Summit)",
    "start": "2026-02-24",
    "end": "2026-02-27",
    "type": "event",
    "location": "Amsterdam, NL",
    "priority": "High",
    "website": "https://ev-summit.com/"
  },
  {
    "id": "event_4",
    "title": "4th Annual EV Charging Infrastructure Forum (Leadvent Group)",
    "start": "2026-02-25",
    "end": "2026-02-26",
    "type": "event",
    "location": "Munich, DE",
    "priority": "High",
    "website": "https://www.leadventgrp.com/events/4th-annual-ev-charging-infrastructure-forum/"
  },
  {
    "id": "event_5",
    "title": "WSED – Smart E-Mobility Track",
    "start": "2026-02-25",
    "end": "2026-02-27",
    "type": "event",
    "location": "Wels, AT",
    "priority": "Medium",
    "website": "https://www.wsed.at/"
  },
  {
    "id": "event_6",
    "title": "KEY – The Energy Transition Expo",
    "start": "2026-03-04",
    "end": "2026-03-06",
    "type": "event",
    "location": "Rimini, IT",
    "priority": "Medium",
    "website": "https://www.key-expo.com/"
  },
  {
    "id": "event_7",
    "title": "eMobility Expo World Congress (MOW)",
    "start": "2026-03-10",
    "end": "2026-03-11",
    "type": "event",
    "location": "Malaga, ES",
    "priority": "High",
    "website": "https://emobilityworldcongress.com/"
  },
  {
    "id": "event_8",
    "title": "Solar Solutions",
    "start": "2026-03-10",
    "end": "2026-03-12",
    "type": "event",
    "location": "Amsterdam, NL",
    "priority": "Low",
    "website": "https://www.solarsolutions.nl/"
  },
  {
    "id": "event_9",
    "title": "Vehicle-to-Grid, Vehicle-to-Home & Smart Charging Conference",
    "start": "2026-04-15",
    "end": "2026-04-16",
    "type": "event",
    "location": "Münster, DE",
    "priority": "Medium",
    "website": "https://www.vehicle-2-grid.eu/en/"
  },
  {
    "id": "event_10",
    "title": "EV Infrastructure Expo",
    "start": "2026-04-23",
    "end": "2026-04-24",
    "type": "event",
    "location": "Silverstone, UK",
    "priority": "Medium",
    "website": "https://evinfraexpo.com/"
  },
  {
    "id": "event_11",
    "title": "ChargeTec",
    "start": "2026-04-28",
    "end": "2026-04-29",
    "type": "event",
    "location": "Munich, DE",
    "priority": "High",
    "website": "https://www.chargetec-online.de/en/"
  },
  {
    "id": "event_12",
    "title": "Euro EV Show (EEVS)",
    "start": "2026-05-05",
    "end": "2026-05-06",
    "type": "event",
    "location": "Madrid, ES",
    "priority": "Medium",
    "website": "https://www.euroevshow.com/"
  },
  {
    "id": "event_13",
    "title": "Nordic EV Summit",
    "start": "2026-05-06",
    "end": "2026-05-07",
    "type": "event",
    "location": "Lillestrom, NO",
    "priority": "Medium",
    "website": "https://www.nordicevs.com/"
  },
  {
    "id": "event_14",
    "title": "Everything Electric North",
    "start": "2026-05-08",
    "end": "2026-05-09",
    "type": "event",
    "location": "Harrogate, UK",
    "priority": "Low",
    "website": "https://www.everythingelectricnorth.co.uk/"
  },
  {
    "id": "event_15",
    "title": "London EV Show",
    "start": "2026-05-13",
    "end": "2026-05-14",
    "type": "event",
    "location": "London, UK",
    "priority": "High",
    "website": "https://www.londonevshow.com/"
  },
  {
    "id": "event_16",
    "title": "Drive to Zero",
    "start": "2026-06-02",
    "end": "2026-06-03",
    "type": "event",
    "location": "Paris, FR",
    "priority": "Medium",
    "website": "https://drivetozero.co.uk/"
  },
  {
    "id": "event_17",
    "title": "The Battery Show Europe / EV Tech Expo Europe",
    "start": "2026-06-09",
    "end": "2026-06-11",
    "type": "event",
    "location": "Stuttgart, DE",
    "priority": "High",
    "website": "https://www.thebatteryshow.eu/"
  },
  {
    "id": "event_18",
    "title": "iVT Expo",
    "start": "2026-06-10",
    "end": "2026-06-11",
    "type": "event",
    "location": "Cologne, DE",
    "priority": "Low",
    "website": "https://www.ivtexpo.com/"
  },
  {
    "id": "event_19",
    "title": "MOVE",
    "start": "2026-06-17",
    "end": "2026-06-18",
    "type": "event",
    "location": "London, UK",
    "priority": "High",
    "website": "https://www.terrapinn.com/exhibition/move/index.stm"
  },
  {
    "id": "event_20",
    "title": "Power2Drive Europe Conference",
    "start": "2026-06-22",
    "end": "2026-06-23",
    "type": "event",
    "location": "Munich, DE",
    "priority": "High",
    "website": "https://www.powertodrive.eu/"
  },
  {
    "id": "event_21",
    "title": "Power2Drive Europe (Exhibition)",
    "start": "2026-06-23",
    "end": "2026-06-25",
    "type": "event",
    "location": "Munich, DE",
    "priority": "High",
    "website": "https://www.powertodrive.eu/"
  },
  {
    "id": "event_22",
    "title": "Vehicle Electrification Expo",
    "start": "2026-07-08",
    "end": "2026-07-09",
    "type": "event",
    "location": "Birmingham, UK",
    "priority": "Medium",
    "website": "https://www.vehicleelectrificationexpo.co.uk/"
  },
  {
    "id": "event_25",
    "title": "Intercharge Network Conference (ICNC)",
    "start": "2026-09-01",
    "end": "2026-09-01",
    "type": "event",
    "location": "Berlin, DE",
    "priority": "Medium",
    "website": "https://www.icnc-conference.com/"
  },
  {
    "id": "event_23",
    "title": "Everything Electric Greater London",
    "start": "2026-09-11",
    "end": "2026-09-12",
    "type": "event",
    "location": "London, UK",
    "priority": "Medium",
    "website": "https://www.everythingelectric.co.uk/"
  },
  {
    "id": "event_24",
    "title": "EVCharge Live UK",
    "start": "2026-09-22",
    "end": "2026-09-24",
    "type": "event",
    "location": "Birmingham, UK",
    "priority": "High",
    "website": "https://evchargelive.co.uk/"
  },
  {
    "id": "event_26",
    "title": "Energie Vakbeurs",
    "start": "2026-10-06",
    "end": "2026-10-08",
    "type": "event",
    "location": "Den Bosch, NL",
    "priority": "Medium",
    "website": "https://www.energievakbeurs.nl/"
  },
  {
    "id": "event_27",
    "title": "E-CHARGE",
    "start": "2026-10-07",
    "end": "2026-10-09",
    "type": "event",
    "location": "Bologna, IT",
    "priority": "Medium",
    "website": "https://www.e-charge.it/"
  },
  {
    "id": "event_28",
    "title": "E-TECH EUROPE",
    "start": "2026-10-07",
    "end": "2026-10-09",
    "type": "event",
    "location": "Bologna, IT",
    "priority": "Medium",
    "website": "https://www.e-techeurope.com/"
  },
  {
    "id": "event_29",
    "title": "eMove360 Europe",
    "start": "2026-10-13",
    "end": "2026-10-14",
    "type": "event",
    "location": "Munich, DE",
    "priority": "High",
    "website": "https://www.emove360.com/"
  },
  {
    "id": "event_30",
    "title": "eMobility Expo",
    "start": "2026-12-01",
    "end": "2026-12-03",
    "type": "event",
    "location": "Warsaw, PL",
    "priority": "Medium",
    "website": "https://emobilityexpo.pl/"
  },
  {
    "id": "h1",
    "title": "New Year's Day",
    "start": "2026-01-01",
    "end": "2026-01-01",
    "type": "holiday"
  },
  {
    "id": "h2",
    "title": "Good Friday",
    "start": "2026-04-03",
    "end": "2026-04-03",
    "type": "holiday"
  },
  {
    "id": "h3",
    "title": "Easter Sunday",
    "start": "2026-04-05",
    "end": "2026-04-05",
    "type": "holiday"
  },
  {
    "id": "h4",
    "title": "Easter Monday",
    "start": "2026-04-06",
    "end": "2026-04-06",
    "type": "holiday"
  },
  {
    "id": "h5",
    "title": "King's Day",
    "start": "2026-04-27",
    "end": "2026-04-27",
    "type": "holiday"
  },
  {
    "id": "h6",
    "title": "Ascension Day",
    "start": "2026-05-14",
    "end": "2026-05-14",
    "type": "holiday"
  },
  {
    "id": "h7",
    "title": "Whit Sunday",
    "start": "2026-05-24",
    "end": "2026-05-24",
    "type": "holiday"
  },
  {
    "id": "h8",
    "title": "Whit Monday",
    "start": "2026-05-25",
    "end": "2026-05-25",
    "type": "holiday"
  },
  {
    "id": "h9",
    "title": "Christmas Day",
    "start": "2026-12-25",
    "end": "2026-12-25",
    "type": "holiday"
  },
  {
    "id": "h10",
    "title": "Boxing Day",
    "start": "2026-12-26",
    "end": "2026-12-26",
    "type": "holiday"
  }
];

        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby9Aoj_XCkUPdp_4YOjDuybqRfLBI9dhY7oiU9c-LzVmWKS6RtyFjkaanOlPR7pJVtlag/exec';

        let events = [...CALENDAR_EVENTS];
        let currentView = 'year';
        let currentYear = 2026;
        let currentMonth = 0; // January
        let currentWeekStart = new Date(2026, 0, 1);

        // Generate office days for 2026
        function generateOfficeDays() {
            const officeDays = [];
            
            // List of dates to exclude (holidays)
            const excludeDates = new Set([
                '2026-01-01', // New Year's Day (Thursday)
                '2026-01-02', // Day after New Year
                '2026-04-03', // Good Friday
                '2026-04-06', // Easter Monday
                '2026-04-27', // King's Day
                '2026-05-14', // Ascension Day (Thursday)
                '2026-05-25', // Whit Monday
                '2026-12-25', // Christmas Day
                '2026-12-28', // Monday after Boxing Day
            ]);
            
            let officeId = 1;
            
            // Generate for each month
            for (let month = 0; month < 12; month++) {
                const daysInMonth = new Date(2026, month + 1, 0).getDate();
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(2026, month, day);
                    const dayOfWeek = date.getDay(); // 0=Sunday, 1=Monday, ..., 6=Saturday
                    
                    // Format date as YYYY-MM-DD
                    const year = date.getFullYear();
                    const monthStr = String(date.getMonth() + 1).padStart(2, '0');
                    const dayStr = String(date.getDate()).padStart(2, '0');
                    const dateStr = `${year}-${monthStr}-${dayStr}`;
                    
                    // Check if it's Monday (1) or Thursday (4)
                    const isMonday = dayOfWeek === 1;
                    const isThursday = dayOfWeek === 4;
                    
                    if (isMonday || isThursday) {
                        // Skip if it's a holiday or Feb 12
                        if (excludeDates.has(dateStr) || dateStr === '2026-02-12') {
                            continue;
                        }
                        
                        officeDays.push({
                            id: 'office_' + officeId++,
                            title: 'Office Day',
                            start: dateStr,
                            end: dateStr,
                            type: 'office'
                        });
                    } else if (dateStr === '2026-02-11') {
                        // Special case: Feb 11 (Wednesday) instead of Feb 12 (Thursday)
                        officeDays.push({
                            id: 'office_' + officeId++,
                            title: 'Office Day',
                            start: dateStr,
                            end: dateStr,
                            type: 'office'
                        });
                    }
                }
            }
            
            return officeDays;
        }

        // Add office days to events
        events = [...CALENDAR_EVENTS, ...generateOfficeDays()];
        
        // Set initial week start to first Monday of 2026
        let initialWeekStart = new Date(2026, 0, 1);
        while (initialWeekStart.getDay() !== 1) {
            initialWeekStart.setDate(initialWeekStart.getDate() + 1);
        }
        currentWeekStart = initialWeekStart;

        // Fetch custom events from Google Sheet
        async function loadSavedEvents() {
            try {
                console.log('Fetching events from Google Sheet...');
                const response = await fetch(APPS_SCRIPT_URL + '?action=list');
                const data = await response.json();
                if (data.success && data.events) {
                    // Normalize dates from sheet (may come as ISO timestamps)
                    const sheetEvents = data.events.map(e => ({
                        ...e,
                        start: String(e.start).slice(0, 10),
                        end: String(e.end).slice(0, 10)
                    }));
                    console.log('Loaded from sheet:', sheetEvents.length, 'events');
                    // Cache in localStorage as fallback
                    localStorage.setItem('calendarBirthdays', JSON.stringify(sheetEvents));
                    events = [...CALENDAR_EVENTS, ...generateOfficeDays(), ...sheetEvents];
                } else {
                    console.warn('Sheet fetch failed, using localStorage fallback');
                    loadFromLocalStorage();
                }
            } catch (err) {
                console.warn('Sheet unavailable, using localStorage fallback:', err);
                loadFromLocalStorage();
            }
            renderCalendar();
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('calendarBirthdays');
            if (saved) {
                const cached = JSON.parse(saved);
                events = [...CALENDAR_EVENTS, ...generateOfficeDays(), ...cached];
            }
        }

        // Save to Google Sheet (add)
        async function saveEventToSheet(newEvent) {
            try {
                const params = new URLSearchParams({ action: 'add' });
                for (const [key, val] of Object.entries(newEvent)) {
                    if (val) params.set(key, val);
                }
                await fetch(APPS_SCRIPT_URL + '?' + params.toString());
                console.log('Event saved to sheet');
            } catch (err) {
                console.error('Failed to save to sheet:', err);
            }
        }

        // Delete from Google Sheet
        async function deleteEventFromSheet(eventId) {
            try {
                await fetch(APPS_SCRIPT_URL + '?action=delete&id=' + encodeURIComponent(eventId));
                console.log('Event deleted from sheet');
            } catch (err) {
                console.error('Failed to delete from sheet:', err);
            }
        }

        function saveBirthdays() {
            // Keep localStorage as cache
            const userCreatedEvents = events.filter(e => e.id && e.id.includes('_custom_'));
            localStorage.setItem('calendarBirthdays', JSON.stringify(userCreatedEvents));
        }

        function changeView(view) {
            currentView = view;
            document.querySelectorAll('.view-buttons .btn-secondary').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            renderCalendar();
        }

        function navigate(direction) {
            if (currentView === 'year') {
                currentYear += direction;
            } else if (currentView === 'month') {
                currentMonth += direction;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                } else if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
            } else if (currentView === 'week') {
                currentWeekStart = new Date(currentWeekStart);
                currentWeekStart.setDate(currentWeekStart.getDate() + (direction * 7));
            }
            renderCalendar();
        }

        function getEventsForDate(date) {
            // Normalize to local date string for comparison (YYYY-MM-DD)
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const dateStr = `${year}-${month}-${day}`;
            
            return events.filter(event => {
                // Compare date strings directly to avoid timezone issues
                return event.start <= dateStr && event.end >= dateStr;
            });
        }

        function renderYearView() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            
            let html = '<div class="year-view">';
            
            for (let month = 0; month < 12; month++) {
                html += `<div class="month-mini" onclick="goToMonth(${month})">`;
                html += `<h3>${monthNames[month]}</h3>`;
                html += '<div class="mini-calendar">';
                
                // Day headers
                ['M', 'T', 'W', 'T', 'F', 'S', 'S'].forEach(day => {
                    html += `<div class="mini-day-header">${day}</div>`;
                });
                
                // Get first day of month (adjust for Monday start)
                const firstDay = new Date(currentYear, month, 1);
                const lastDay = new Date(currentYear, month + 1, 0);
                let startingDayOfWeek = firstDay.getDay() - 1; // Adjust so Monday = 0
                if (startingDayOfWeek === -1) startingDayOfWeek = 6; // Sunday becomes 6
                
                // Previous month days
                for (let i = 0; i < startingDayOfWeek; i++) {
                    html += '<div class="mini-day other-month"></div>';
                }
                
                // Current month days
                for (let day = 1; day <= lastDay.getDate(); day++) {
                    const date = new Date(currentYear, month, day);
                    const dayEvents = getEventsForDate(date);
                    const isToday = date.toDateString() === new Date().toDateString();
                    
                    // Determine primary color class
                    let colorClass = '';
                    if (dayEvents.length > 0) {
                        const eventTypes = dayEvents.map(e => e.type);
                        if (eventTypes.length > 1 && new Set(eventTypes).size > 1) {
                            colorClass = 'multiple';
                        } else {
                            colorClass = dayEvents[0].type;
                        }
                    }
                    
                    html += `<div class="mini-day ${isToday ? 'today' : ''} ${dayEvents.length > 0 ? 'has-event ' + colorClass : ''}">`;
                    html += `<div class="mini-day-number">${day}</div>`;
                    
                    if (dayEvents.length > 0) {
                        // Add tooltip with event names
                        html += '<div class="mini-day-tooltip">';
                        dayEvents.forEach((evt, idx) => {
                            if (idx > 0) html += '<br>';
                            html += evt.title;
                        });
                        html += '</div>';
                    }
                    
                    html += '</div>';
                }
                
                html += '</div></div>';
            }
            
            html += '</div>';
            
            document.getElementById('calendarContent').innerHTML = html;
            document.getElementById('currentPeriod').textContent = currentYear;
        }

        function goToMonth(month) {
            currentMonth = month;
            changeView('month');
            document.querySelectorAll('.view-buttons .btn-secondary').forEach((btn, idx) => {
                btn.classList.remove('active');
                if (idx === 1) btn.classList.add('active');
            });
        }

        function renderMonthView() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const monthLength = lastDay.getDate();
            
            // Get day of week for first day (0=Sunday, 1=Monday, ..., 6=Saturday)
            let startingDayOfWeek = firstDay.getDay();
            // Convert to Monday start (0=Monday, 1=Tuesday, ..., 6=Sunday)
            startingDayOfWeek = startingDayOfWeek === 0 ? 6 : startingDayOfWeek - 1;
            
            let html = '<div class="month-view"><div class="month-grid">';
            
            // Day headers
            ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'].forEach(day => {
                html += `<div class="day-header">${day}</div>`;
            });
            
            // Previous month days
            const prevMonthLastDay = new Date(currentYear, currentMonth, 0).getDate();
            for (let i = startingDayOfWeek - 1; i >= 0; i--) {
                const day = prevMonthLastDay - i;
                html += `<div class="day-cell other-month"><div class="day-number">${day}</div></div>`;
            }
            
            // Current month days
            for (let day = 1; day <= monthLength; day++) {
                const date = new Date(currentYear, currentMonth, day);
                const dayEvents = getEventsForDate(date);
                const isToday = date.toDateString() === new Date().toDateString();
                
                html += `<div class="day-cell ${isToday ? 'today' : ''}" onclick="dayClick('${date.toISOString()}')">`;
                html += `<div class="day-number">${day}</div>`;
                html += '<div class="day-events">';
                
                dayEvents.forEach(event => {
                    html += `<div class="event-badge ${event.type}" onclick="event.stopPropagation(); viewEvent('${event.id}')" title="${event.title}">${event.title}</div>`;
                });
                
                html += '</div></div>';
            }
            
            // Next month days
            const usedCells = startingDayOfWeek + monthLength;
            const remainingCells = 42 - usedCells;
            for (let day = 1; day <= remainingCells; day++) {
                html += `<div class="day-cell other-month"><div class="day-number">${day}</div></div>`;
            }
            
            html += '</div></div>';
            
            document.getElementById('calendarContent').innerHTML = html;
            document.getElementById('currentPeriod').textContent = `${monthNames[currentMonth]} ${currentYear}`;
        }

        function renderWeekView() {
            const weekStart = new Date(currentWeekStart);
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);
            
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            
            let html = '<div class="week-view"><div class="week-grid">';
            
            // Empty corner cell
            html += '<div class="time-slot"></div>';
            
            // Day headers
            const dayNames = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            for (let i = 0; i < 7; i++) {
                const date = new Date(weekStart);
                date.setDate(date.getDate() + i);
                const isToday = date.toDateString() === new Date().toDateString();
                const dayOfWeek = date.getDay();
                const adjustedDayIndex = dayOfWeek === 0 ? 6 : dayOfWeek - 1; // Adjust so Monday = 0
                html += `<div class="week-day-header ${isToday ? 'today' : ''}">
                    ${dayNames[adjustedDayIndex]}<br>
                    ${monthNames[date.getMonth()]} ${date.getDate()}
                </div>`;
            }
            
            // All day events
            html += '<div class="time-slot">All Day</div>';
            for (let i = 0; i < 7; i++) {
                const date = new Date(weekStart);
                date.setDate(date.getDate() + i);
                const dayEvents = getEventsForDate(date);
                const isToday = date.toDateString() === new Date().toDateString();
                
                html += `<div class="week-day-cell ${isToday ? 'today' : ''}">`;
                dayEvents.forEach(event => {
                    html += `<div class="week-event ${event.type}" onclick="viewEvent('${event.id}')">${event.title}</div>`;
                });
                html += '</div>';
            }
            
            html += '</div></div>';
            
            document.getElementById('calendarContent').innerHTML = html;
            
            const startStr = `${monthNames[weekStart.getMonth()]} ${weekStart.getDate()}`;
            const endStr = `${monthNames[weekEnd.getMonth()]} ${weekEnd.getDate()}, ${weekEnd.getFullYear()}`;
            document.getElementById('currentPeriod').textContent = `${startStr} - ${endStr}`;
        }

        function renderCalendar() {
            if (currentView === 'year') {
                renderYearView();
            } else if (currentView === 'month') {
                renderMonthView();
            } else {
                renderWeekView();
            }
        }

        function openAddModal() {
            document.getElementById('addModal').classList.add('active');
            document.getElementById('eventDate').valueAsDate = new Date();
            document.getElementById('eventType').value = 'birthday';
            updateFormForType();
        }

        function updateFormForType() {
            const type = document.getElementById('eventType').value;
            const nameLabel = document.getElementById('nameLabel');
            const nameInput = document.getElementById('eventName');
            
            if (type === 'birthday') {
                nameLabel.textContent = 'Name';
                nameInput.placeholder = 'Team member name';
            } else if (type === 'employee-holiday') {
                nameLabel.textContent = 'Employee Name';
                nameInput.placeholder = 'Who is taking holiday?';
            } else if (type === 'event') {
                nameLabel.textContent = 'Event Name';
                nameInput.placeholder = 'e.g., EV Conference, Trade Show';
            } else if (type === 'other') {
                nameLabel.textContent = 'Event Name';
                nameInput.placeholder = 'e.g., Company Meeting, Training';
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function dayClick(dateStr) {
            const date = new Date(dateStr);
            document.getElementById('eventDate').valueAsDate = date;
            openAddModal();
        }

        function addEvent(e) {
            e.preventDefault();
            console.log('addEvent called');

            const name = document.getElementById('eventName').value;
            const date = document.getElementById('eventDate').value;
            let endDate = document.getElementById('eventEndDate').value;
            const notes = document.getElementById('eventNotes').value;
            const type = document.getElementById('eventType').value;

            console.log('Event details:', { name, date, endDate, type, notes });

            // If end date is not provided, default to start date
            if (!endDate) {
                endDate = date;
                console.log('End date was empty, set to:', endDate);
            }
            
            const newEvent = {
                id: type + '_custom_' + Date.now(),
                title: name,
                start: date,
                end: endDate,
                type: type,
                notes: notes
            };
            console.log('Created new event:', newEvent);

            // Filter out old event to avoid duplicates, keep office days
            const nonUserEvents = events.filter(e => e.id !== newEvent.id);
            events = [...nonUserEvents, newEvent];
            console.log('Events array after adding:', events.length, 'events');
            saveBirthdays();
            saveEventToSheet(newEvent);
            console.log('Event saved to sheet and localStorage');

            closeModal('addModal');
            renderCalendar();
            
            // Reset form
            document.getElementById('eventName').value = '';
            document.getElementById('eventNotes').value = '';
            document.getElementById('eventType').value = 'birthday';
        }

        function viewEvent(eventId) {
            const event = events.find(e => e.id === eventId);
            if (!event) return;
            
            const modal = document.getElementById('viewModal');
            document.getElementById('viewEventTitle').textContent = event.title;
            
            let content = '<div class="event-details">';
            
            if (event.type === 'event') {
                content += `<p><strong>📍 Location:</strong> ${event.location || 'Not specified'}</p>`;
                content += `<p><strong>📅 Date:</strong> ${formatDate(event.start)}`;
                if (event.start !== event.end) {
                    content += ` - ${formatDate(event.end)}`;
                }
                content += '</p>';
                if (event.priority) {
                    content += `<p><strong>⭐ Priority:</strong> ${event.priority}</p>`;
                }
                if (event.website) {
                    content += `<p><strong>🔗 Website:</strong> <a href="${event.website}" target="_blank">${event.website}</a></p>`;
                }
                // Only allow deletion if it's a user-added event (not from the original data)
                if (event.id.startsWith('event_') && event.id.includes('_custom_')) {
                    content += `<button class="btn btn-delete" onclick="deleteEvent('${event.id}')">Delete Event</button>`;
                }
            } else if (event.type === 'holiday') {
                content += `<p><strong>📅 Date:</strong> ${formatDate(event.start)}</p>`;
                content += `<p>🇳🇱 Dutch Public Holiday</p>`;
            } else if (event.type === 'birthday') {
                content += `<p><strong>🎂 Birthday:</strong> ${formatDate(event.start)}</p>`;
                if (event.notes) {
                    content += `<p><strong>📝 Notes:</strong> ${event.notes}</p>`;
                }
                content += `<button class="btn btn-delete" onclick="deleteEvent('${event.id}')">Delete Birthday</button>`;
            } else if (event.type === 'employee-holiday') {
                content += `<p><strong>🏖️ Employee Holiday:</strong> ${formatDate(event.start)}</p>`;
                content += `<p><strong>👤 Employee:</strong> ${event.title}</p>`;
                if (event.notes) {
                    content += `<p><strong>📝 Notes:</strong> ${event.notes}</p>`;
                }
                content += `<button class="btn btn-delete" onclick="deleteEvent('${event.id}')">Delete Employee Holiday</button>`;
            } else if (event.type === 'office') {
                content += `<p><strong>🏢 Office Day:</strong> ${formatDate(event.start)}</p>`;
                content += `<p>Regular office day - Team works from the office</p>`;
            } else if (event.type === 'other') {
                content += `<p><strong>📌 Event:</strong> ${formatDate(event.start)}</p>`;
                if (event.notes) {
                    content += `<p><strong>📝 Notes:</strong> ${event.notes}</p>`;
                }
                content += `<button class="btn btn-delete" onclick="deleteEvent('${event.id}')">Delete Event</button>`;
            }
            
            content += '</div>';
            
            document.getElementById('viewEventContent').innerHTML = content;
            modal.classList.add('active');
        }

        function deleteEvent(eventId) {
            const event = events.find(e => e.id === eventId);
            let eventTypeName = 'event';
            
            if (event.type === 'birthday') {
                eventTypeName = 'birthday';
            } else if (event.type === 'employee-holiday') {
                eventTypeName = 'employee holiday';
            } else if (event.type === 'event') {
                eventTypeName = 'EV event';
            } else if (event.type === 'other') {
                eventTypeName = 'event';
            }
            
            if (confirm(`Are you sure you want to delete this ${eventTypeName}?`)) {
                events = events.filter(e => e.id !== eventId);
                saveBirthdays();
                deleteEventFromSheet(eventId);
                closeModal('viewModal');
                renderCalendar();
            }
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        // Initialize immediately when script loads
        (async function() {
            console.log('Initializing calendar...');
            console.log('Total base events:', CALENDAR_EVENTS.length);

            try {
                // Initialize with base events + office days
                events = [...CALENDAR_EVENTS, ...generateOfficeDays()];

                // Show calendar immediately with base events
                renderCalendar();

                // Then fetch custom events from Google Sheet (async)
                await loadSavedEvents();
                console.log('Calendar rendered successfully with', events.length, 'events');
            } catch (error) {
                console.error('Error initializing calendar:', error);
                const content = document.getElementById('calendarContent');
                if (content) {
                    content.innerHTML = '<div style="padding: 50px; text-align: center; color: red;"><h2>Error loading calendar</h2><p>' + error.message + '</p></div>';
                }
            }
        })();
    </script>
</body>
</html>
